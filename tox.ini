########################################################################################
# Copyright 2019 Stephen McDowell                                                      #
#                                                                                      #
# Licensed under the Apache License, Version 2.0 (the "License");                      #
# you may not use this file except in compliance with the License.                     #
# You may obtain a copy of the License at                                              #
#                                                                                      #
#     http://www.apache.org/licenses/LICENSE-2.0                                       #
#                                                                                      #
# Unless required by applicable law or agreed to in writing, software                  #
# distributed under the License is distributed on an "AS IS" BASIS,                    #
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.             #
# See the License for the specific language governing permissions and                  #
# limitations under the License.                                                       #
########################################################################################
[tox]
# Default environments to run with vanilla `tox`
envlist = py, lint

[testenv]
# Required to be able to send coverage reports from Travis to codecov
passenv = PYTHONWARNINGS TOXENV CI TRAVIS TRAVIS_*
usedevelop = true
deps =
    pytest
    pytest-cov
    # not a real dependency, but used if available <3
    Pygments
commands =
    pytest . {posargs}
    {envpython} -V -V

[testenv:lint]
skip_install = true
deps =
    flake8
    flake8-docstrings
    flake8-import-order
    pep8-naming
    pytest-flake8
    mypy
    pytest-mypy
commands =
    flake8 --version
    pytest --flake8 -m flake8 docs/ ci_exec/ tests/
    mypy --version
    pytest --mypy -m mypy docs/ ci_exec/ tests/

[testenv:docs]
deps =
    -rdocs/requirements.txt
commands =
    sphinx-build -W -n -b html -d {envtmpdir}/doctrees docs/source {envtmpdir}/html

[testenv:linkcheck]
deps =
    -rdocs/requirements.txt
commands =
    sphinx-build -W -n -b linkcheck -d {envtmpdir}/doctrees docs/source {envtmpdir}/linkcheck

[testenv:dist]
skip_install = true
deps =
    readme_renderer
commands =
    # Checks RST for uploading to PyPi
    {envpython} setup.py check -r -s
    {envpython} setup.py sdist
    {envpython} setup.py bdist_wheel --universal

# Not exactly a typical thing to do with tox...but suits my workflow.
[testenv:clean]
skip_install = true
deps =
whitelist_externals =
    find
    rm
commands =
    rm -rf build/
    rm -rf dist/
    rm -rf ci_exec.egg-info/
    rm -rf .eggs/
    rm -rf tests/.cache
    rm -rf .mypy_cache
    find . -name "*.py[co]" -type f -exec rm -f \{\} +
    find . -name "__pycache__" -type d -exec rm -rf \{\} +
